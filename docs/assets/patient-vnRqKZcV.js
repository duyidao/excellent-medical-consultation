import{M}from"./MySvgIcon-942L7yLE.js";import{M as R}from"./MyNavBar-juD04P2Y.js";import{M as Q}from"./MyRadioBtn-XW1rGM3m.js";import{a as W,e as X,b as Y,d as Z}from"./user-eeNM9fpv.js";import{n as ee,i as ae}from"./index-VIQo9Yu7.js";import{d as te,B as oe,z as le,q as $,e as i,i as ne,x as se,r as d,o as u,c,a as o,A as f,f as l,F as ue,g as ie,w as r,D as de,t as h,u as I,h as ce,b as N,s as re,v as ve,_ as pe}from"./index-erOPif8K.js";import{a as _e,c as V}from"./index-mAaPtwf-.js";import{s as U}from"./function-call-6z9IMAhC.js";const C=g=>(re("data-v-0a1f0697"),g=g(),ve(),g),me={class:"patient-page"},fe={key:0,class:"patient-change"},ge=C(()=>l("h3",null,"请选择患者信息",-1)),he=C(()=>l("p",null,"以便医生给出更准确的治疗，信息仅医生可见",-1)),Ce=[ge,he],be={class:"patient-list"},ke=["onClick"],we={class:"info"},ye={class:"name"},Ve={class:"id"},Fe=["onClick"],xe={key:0,class:"tag"},Pe=C(()=>l("p",null,"添加患者",-1)),Se=C(()=>l("div",{class:"patient-tip"},"最多可添加 6 人",-1)),Be={key:1,class:"patient-next"},Me=te({__name:"patient",setup(g){const D=oe(),z=le(),_=$(()=>D.query.isChange==="1"),L=i(_.value?"选择患者":"家庭档案"),v=i(),T=n=>{_.value&&(v.value=n.id)},p=i([]),b=async()=>{const n=await W();if(p.value=n.data,_.value&&p.value.length){const a=p.value.find(s=>s.defaultFlag===1);a?v.value=a.id:v.value=p.value[0].id}};ne(()=>{b()});const q=i([{label:"男",value:1},{label:"女",value:2}]),F={name:"",idCard:"",gender:1,defaultFlag:0},m=i(!1),x=n=>{if(m.value=!0,n){const{id:a,gender:s,name:k,idCard:w,defaultFlag:y}=n;e.value={id:a,gender:s,name:k,idCard:w,defaultFlag:y}}else e.value={...F}},e=i({...F}),P=$({get(){return e.value.defaultFlag!==0},set(n){e.value.defaultFlag=n?1:0}}),S=()=>{m.value=!1},B=i(),A=async()=>{var a;await((a=B.value)==null?void 0:a.validate()),+e.value.idCard.slice(-2,-1)%2!==e.value.gender&&await U({title:"温馨提示",message:`填写的性别和身份证号中的不一致
您确认提交吗？`}),e.value.id?(await X(e.value),V("编辑成功")):(await Y(e.value),V("添加成功")),b(),S()},E=async()=>{e.value.id&&(await U({title:"温馨提示",message:`您确认要删除 ${e.value.name} 患者信息吗 ？`}),await Z(e.value.id),m.value=!1,b(),V("删除成功"))},j=se(),G=()=>{if(!v.value)return _e("请选就诊择患者");j.setPatient(v.value),z.push("/consult/pay")};return(n,a)=>{const s=d("van-field"),k=d("van-checkbox"),w=d("van-form"),y=d("van-action-bar-button"),H=d("van-action-bar"),J=d("van-popup"),K=d("van-button");return u(),c("div",me,[o(R,{title:L.value},null,8,["title"]),_.value?(u(),c("div",fe,Ce)):f("",!0),l("div",be,[(u(!0),c(ue,null,ie(p.value,t=>(u(),c("div",{class:de(["patient-item",{selected:v.value===t.id}]),key:t.id,onClick:O=>T(t)},[l("div",we,[l("span",ye,h(t.name),1),l("span",Ve,h(t.idCard.replace(/^(.{6}).+(.{4})$/,"$1********$2")),1),l("span",null,h(t.genderValue),1),l("span",null,h(t.age)+"岁",1)]),l("div",{class:"icon",onClick:O=>x(t)},[o(M,{class:"cp-icon",name:"user-edit"})],8,Fe),t.defaultFlag===1?(u(),c("div",xe,"默认")):f("",!0)],10,ke))),128)),p.value.length<7?(u(),c("div",{key:0,class:"patient-add",onClick:a[0]||(a[0]=t=>x())},[o(M,{name:"user-add"}),Pe])):f("",!0),Se]),o(J,{show:m.value,"onUpdate:show":a[5]||(a[5]=t=>m.value=t),position:"right"},{default:r(()=>[o(R,{title:e.value.id?"编辑患者":"添加患者",back:S,"right-text":"保存",onClickRight:A},null,8,["title"]),o(w,{autocomplete:"off",ref_key:"form",ref:B},{default:r(()=>[o(s,{modelValue:e.value.name,"onUpdate:modelValue":a[1]||(a[1]=t=>e.value.name=t),label:"真实姓名",rules:I(ee),placeholder:"请输入真实姓名"},null,8,["modelValue","rules"]),o(s,{modelValue:e.value.idCard,"onUpdate:modelValue":a[2]||(a[2]=t=>e.value.idCard=t),label:"身份证号",rules:I(ae),placeholder:"请输入身份证号"},null,8,["modelValue","rules"]),o(s,{label:"性别",class:"pb4"},{input:r(()=>[o(Q,{options:q.value,modelValue:e.value.gender,"onUpdate:modelValue":a[3]||(a[3]=t=>e.value.gender=t)},null,8,["options","modelValue"])]),_:1}),o(s,{label:"默认就诊人"},{input:r(()=>[o(k,{modelValue:P.value,"onUpdate:modelValue":a[4]||(a[4]=t=>P.value=t),"icon-size":18,round:""},null,8,["modelValue"])]),_:1})]),_:1},512),e.value.id?(u(),ce(H,{key:0},{default:r(()=>[o(y,{onClick:E},{default:r(()=>[N("删除")]),_:1})]),_:1})):f("",!0)]),_:1},8,["show"]),_.value?(u(),c("div",Be,[o(K,{type:"primary",round:"",block:"",onClick:G},{default:r(()=>[N("下一步")]),_:1})])):f("",!0)])}}}),Te=pe(Me,[["__scopeId","data-v-0a1f0697"]]);export{Te as default};
